<?xml version="1.0" encoding="UTF-8"?>
<project name="jomdoc" default="build-library" basedir=".">

  <target name="init">
	<!-- The variable scala.home holds the directory in which to find the scala compiler. -->
	<property name="scala.home" value=".." />
	<!-- The variable scalac.classpath holds all paths needed for the scalac task. -->
	<path id="scalac.classpath">
		<pathelement location="${scala.home}/lib/scala-library.jar"/>
		<pathelement location="${scala.home}/lib/scala-compiler.jar"/>
	</path>
	<!-- This defines the task scalac (which is similar to javac but for scala). -->
	<taskdef resource="scala/tools/ant/antlib.xml" classpathref="scalac.classpath"/>
    <!-- Create the time stamp -->
    <tstamp />
  </target>

  <target name="clean">
    <delete dir="bin" />
  </target>

  <target name="compile-library" depends="init">
    <mkdir dir="${basedir}/bin"/>
    <path id="compile.classpath">
      <pathelement location="../lib/scala-library.jar"/>
      <pathelement location="bin"/>	
      <pathelement location="../lib/tntbase-plugin-api.jar"/>
    </path>
    <scalac destdir="${basedir}/bin" srcdir="${basedir}/src" classpathref="compile.classpath" deprecation="yes"/>
  </target>

  <target name="build-library" depends="compile-library">
    <jar destfile="jomdoc.jar">
      <manifest>
    	<attribute name="Main-Class" value="jomdoc.frontend.Run"/>
    	<attribute name="Class-Path" value="../lib/scala-library.jar"/>
      </manifest>
      <service type="info.kwarc.tntbase.pluginapi.TntIntegrationPlugin"><!-- produces wrong directory, fix by updating to ant 1.7.1 -->
    	<provider classname="jomdoc.tntplugin.TNTValidation"/>
    	<provider classname="jomdoc.tntplugin.TNTPresenter"/>
      </service>
      <fileset dir="${basedir}/bin"/>
    </jar>
  </target>

</project>
