<?xml version="1.0" encoding="UTF-8"?>
<project name="ombase" default="build-library" basedir=".">

	<target name="init">
		<!-- The variable scala.home holds the directory in which to find the scala compiler. -->
		<property name="scala.home" value=".." />
		<!-- The variable scalac.classpath holds all paths needed for the scalac task. -->
		<path id="scalac.classpath">
			<pathelement location="${scala.home}/lib/scala-library.jar"/>
			<pathelement location="${scala.home}/lib/scala-compiler.jar"/>
		</path>
		<!-- This defines the task scalac (which is similar to javac but for scala). -->
		<taskdef resource="scala/tools/ant/antlib.xml" classpathref="scalac.classpath" />
		<!-- The variable compile.classpath holds all paths needed to compile the library. -->
		<path id="compile.classpath">
			<path refid="scalac.classpath" />
			<pathelement location="lib-provided/servlet-api-2.5.jar" />
			<pathelement location="lib/lift-util_2.8.1-2.2-SNAPSHOT.jar" />
			<pathelement location="lib/lift-webkit_2.8.1-2.2-SNAPSHOT.jar" />
			<pathelement location="lib/lift-common_2.8.1-2.2-SNAPSHOT.jar" />
			<pathelement location="lib/lift-json_2.8.1-2.2-SNAPSHOT.jar" />
			<pathelement location="../jomdoc/jomdoc.jar" />
		</path>
	</target>

	<!-- This target deletes the compiled classes. -->
	<target name="clean">
		<delete dir="bin" />
	</target>

	<!-- This target compiles the library using the task scalac and the classpath compile.classpath. -->
	<target name="compile-library" depends="init">
		<mkdir dir="${basedir}/bin" />
		<scalac destdir="${basedir}/bin" srcdir="${basedir}/src" classpathref="compile.classpath" />
	</target>

	<!-- This target collects the compiled classes and all needed libraries into ombase.war. -->
	<target name="build-library" depends="compile-library">
		<war destfile="ombase.war" webxml="src/main/webapp/WEB-INF/web.xml">
			<fileset dir="src/main/webapp" />
			<classes dir="bin" />
			<lib dir="lib" />
			<lib file="${scala.home}/lib/scala-library.jar" />
			<lib file="../jomdoc/jomdoc.jar" />
		</war>
	</target>

</project>
